zuul 可以实现对内的路由，即所有服务之间互相访问的时候，都通过 zuul 来做。但是这不是正确的用法。zuul 接受的请求应该全部来自于外部，主要指前端（浏览器/app）。内部服务互相调用只需要通过 Eureka Server 进行服务发现和调用即可。


API网关前面是HTTP的传输，在这过程中不一定需要中心化的存储，可以尝试用CDN来做边界缓存。热发布服务于所有微服务，微服务接口的变更怎样做到热重启，是一个比较有挑战性的事情。我们之前做的事情只是日志定位，谈不上调用链路跟踪，调用链路跟踪有更专业的解决方案。API网关目前做的只是权限验证，还没有和风控系统结合起来。限流降级也还没有做。在网关上做ab测试会是比较有意义的。


监控

报警

网关流量监控




NIO接入，异步接出
流控与屏蔽
秘钥交换
客户端认证与报文加解密
业务路由框架
报文转换
HTTP DNS/ Direct IP

纯 Java 实现；
支持插件化，方便开发人员自定义组件；
支持横向扩展，高性能；
避免单点故障，稳定性要高，不能因为某个 API 故障导致整个网关停止服务；
管理控制台配置更新可自动生效，不需要重启网关；

理论上监控中心需要承载很大的数据量，比如有 1000 个 API，平均每个 API 一天调用 10 万次，对于很多互联网公司单个 API 的量远远大于 10 万，如果将每次调用的信息都存储起来太浪费，也没有太大的必要。可以考虑将 API 每分钟的调用情况汇总后进行存储，比如 1 分钟的平均响应时间、调用次数、流量、正确率等等。

##### 验证percent比例

数据库选型可以灵活考虑，原则上网关在运行时要尽可能减少对 DB 的依赖，否则 IO 延时会严重影响网关性能。可以考虑首次访问后将 API 配置信息缓存，Admin 对 API 配置更改后通过 Zookeeper 通知网关刷新，这样一来 DB 的访问量可以忽略不计，团队可根据自身偏好灵活选型。

采用 Netty 作为 Http 容器首先需要解决的是 Http 协议的解析和封装，好在 Netty 本身提供了这样的 Handler

组件是网关的核心，大部分功能特性都可以基于组件的形式提供，组件化可以有效提高网关的扩展性。

API网关通过部署多个实例来保证可用性，前端通过Nginx来负载均衡。

一个是协议适配，另一个是公共服务接入，最后是公共接入技术优化